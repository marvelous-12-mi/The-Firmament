<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Synq - Social Media App</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
  body { font-family: 'Inter', sans-serif; transition: background 0.3s, color 0.3s; }
  .post-card { transition: transform 0.3s ease, box-shadow 0.3s ease; background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); border-radius: 1rem; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
  .post-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
  .btn-primary { background: linear-gradient(to right, #6366f1, #8b5cf6); transition: all 0.3s ease; }
  .btn-primary:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
  .like-button.liked i { animation: heart-pop 0.3s forwards; }
  @keyframes heart-pop { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }
  .comment-form { transition: max-height 0.3s ease, opacity 0.3s ease; max-height: 0; overflow: hidden; opacity: 0; }
  .comment-form.active { max-height: 200px; opacity: 1; animation: slide-down 0.3s ease forwards; }
  @keyframes slide-down { 0% { max-height: 0; opacity: 0; } 100% { max-height: 200px; opacity: 1; } }
  .view { opacity: 0; transition: opacity 0.5s ease; }
  .view.active { opacity: 1; }
  html.dark { --bg:#0f1115; --card:#151821; --text:#e8e9ef; --muted:#889; --primary:#7dd3fc; --accent:#a78bfa; background-color: var(--bg); color: var(--text); }
  html.dark .post-card { background: rgba(21,24,33,0.85); }
  #fab-create { transition: transform 0.3s, background 0.3s; }
  #fab-create:hover { transform: scale(1.1); background: #4f46e5; }
</style>
</head>
<body class="min-h-screen flex flex-col bg-gray-100 dark:bg-[var(--bg)] text-gray-900 dark:text-[var(--text)]">

<!-- Navigation Bar -->
<nav class="bg-white dark:bg-[var(--card)] shadow-sm py-4 px-6 flex justify-between items-center sticky top-0 z-10 transition-colors">
  <div class="flex items-center space-x-2">
    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 flex items-center justify-center">
      <span class="text-white font-bold text-xl">S</span>
    </div>
    <h1 class="text-2xl font-bold text-slate-800 dark:text-[var(--text)]">Synq</h1>
  </div>
  <div class="flex items-center space-x-4">
    <div class="hidden md:flex space-x-6">
      <button id="nav-feed" class="flex items-center text-indigo-600 font-semibold nav-link">
        <i class="fas fa-home mr-2"></i> Home
      </button>
      <button id="nav-create" class="flex items-center text-slate-600 dark:text-[var(--muted)] hover:text-indigo-500 nav-link">
        <i class="fas fa-plus mr-2"></i> Create
      </button>
      <button id="nav-profile" class="flex items-center text-slate-600 dark:text-[var(--muted)] hover:text-indigo-500 nav-link">
        <i class="fas fa-user mr-2"></i> Profile
      </button>
    </div>
    <div class="flex items-center space-x-2">
      <span class="hidden md:inline text-slate-800 dark:text-[var(--text)]" id="user-email">Not logged in</span>
      <button id="logout-btn" class="text-slate-600 dark:text-[var(--muted)] hover:text-slate-900 hidden">
        <i class="fas fa-sign-out-alt"></i>
      </button>
      <button id="theme-toggle" class="ml-4 p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
        <i class="fas fa-moon text-gray-700 dark:text-gray-200"></i>
      </button>
    </div>
  </div>
</nav>

<!-- Mobile Navigation -->
<div class="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-[var(--card)] border-t border-gray-200 dark:border-gray-700 py-3 px-6 flex justify-around z-10">
  <button id="mobile-feed" class="flex flex-col items-center text-indigo-600">
    <i class="fas fa-home"></i>
    <span class="text-xs mt-1">Home</span>
  </button>
  <button id="mobile-create" class="flex flex-col items-center text-slate-600 dark:text-[var(--muted)]">
    <i class="fas fa-plus"></i>
    <span class="text-xs mt-1">Create</span>
  </button>
  <button id="mobile-profile" class="flex flex-col items-center text-slate-600 dark:text-[var(--muted)]">
    <i class="fas fa-user"></i>
    <span class="text-xs mt-1">Profile</span>
  </button>
</div>

<!-- Floating Action Button -->
<button id="fab-create" class="fixed bottom-20 right-6 w-16 h-16 rounded-full bg-indigo-600 text-white flex items-center justify-center shadow-xl hover:bg-indigo-500 z-20">
  <i class="fas fa-plus text-2xl"></i>
</button>

<!-- Main Content -->
<main class="flex-grow container mx-auto px-4 py-8 pb-20 md:pb-8">

  <!-- Auth View -->
  <div id="auth-view" class="max-w-md mx-auto view active">
    <div class="bg-white dark:bg-[var(--card)] rounded-xl shadow-md p-8 transition-colors">
      <h2 class="text-2xl font-bold text-center text-slate-800 dark:text-[var(--text)] mb-6" id="auth-title">Join Synq</h2>
      <div id="error-message" class="bg-red-50 text-red-700 p-3 rounded-lg mb-4 hidden"></div>
      <form id="auth-form" class="space-y-4">
        <div>
          <label class="block text-gray-700 dark:text-[var(--muted)] mb-2">Email</label>
          <div class="relative">
            <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"><i class="fas fa-envelope"></i></div>
            <input type="email" id="email-input" class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white dark:bg-[var(--card)] text-gray-900 dark:text-[var(--text)]" placeholder="your@email.com" required />
          </div>
        </div>
        <div>
          <label class="block text-gray-700 dark:text-[var(--muted)] mb-2">Password</label>
          <div class="relative">
            <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"><i class="fas fa-lock"></i></div>
            <input type="password" id="password-input" class="w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white dark:bg-[var(--card)] text-gray-900 dark:text-[var(--text)]" placeholder="••••••••" required />
          </div>
        </div>
        <button type="submit" id="auth-submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold hover:opacity-90 transition">Sign Up</button>
      </form>
      <div class="text-center mt-4">
        <p class="text-gray-600 dark:text-[var(--muted)]">Already have an account? 
          <button id="toggle-auth" class="text-indigo-600 font-semibold">Sign In</button>
        </p>
      </div>
    </div>
  </div>

  <!-- Feed View -->
  <div id="feed-view" class="max-w-2xl mx-auto view hidden">
    <div class="mb-8">
      <h2 class="text-2xl font-bold text-slate-800 dark:text-[var(--text)] mb-6">Latest Posts</h2>
      <!-- Create Post Form -->
      <div class="bg-white dark:bg-[var(--card)] rounded-xl shadow-sm p-6 mb-6">
        <div class="flex space-x-4">
          <div class="bg-gray-200 dark:bg-gray-700 border-2 border-dashed rounded-xl w-12 h-12 flex-shrink-0"></div>
          <div class="flex-grow">
            <textarea id="post-content" placeholder="What's on your mind?" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg p-4 focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white dark:bg-[var(--card)] text-gray-900 dark:text-[var(--text)]" rows="3"></textarea>
            <div class="flex justify-between items-center mt-4">
              <div class="flex space-x-2">
                <button class="text-gray-500 dark:text-[var(--muted)] hover:text-indigo-600"><i class="fas fa-camera"></i></button>
                <button class="text-gray-500 dark:text-[var(--muted)] hover:text-indigo-600"><i class="fas fa-image"></i></button>
              </div>
              <button id="submit-post" class="btn-primary text-white px-6 py-2 rounded-lg font-semibold hover:opacity-90 transition">Post</button>
            </div>
          </div>
        </div>
      </div>
      <div id="posts-container" class="space-y-6">
        <!-- Posts will render here -->
      </div>
    </div>
  </div>

</main>

<script>
  // Supabase setup
  const SUPABASE_URL = 'https://qpfjchiucjhfvyohqhih.supabase.co';
  const SUPABASE_ANON_KEY = 'YOUR_ANON_KEY';
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  let currentUser = null;
  let posts = [];
  let userLikes = new Set();
  let userComments = {};

  // Elements
  const views = {
    auth: document.getElementById('auth-view'),
    feed: document.getElementById('feed-view')
  };

  document.addEventListener('DOMContentLoaded', async () => {
    // Check session
    const { data: { session } } = await supabase.auth.getSession();
    if(session) { currentUser = session.user; showView('feed'); fetchPosts(); }
    else showView('auth');

    setupListeners();
  });

  function setupListeners() {
    document.getElementById('theme-toggle').addEventListener('click', ()=>document.documentElement.classList.toggle('dark'));
    document.getElementById('auth-form').addEventListener('submit', handleAuth);
    document.getElementById('submit-post').addEventListener('click', createPost);
  }

  function showView(view) {
    Object.values(views).forEach(v => v.classList.add('hidden'));
    Object.values(views).forEach(v => v.classList.remove('active'));
    views[view].classList.remove('hidden'); views[view].classList.add('active');
  }

  async function handleAuth(e){
    e.preventDefault();
    const email=document.getElementById('email-input').value;
    const password=document.getElementById('password-input').value;
    const isSignUp = document.getElementById('auth-title').textContent.includes('Join');

    let result;
    if(isSignUp) result=await supabase.auth.signUp({email,password});
    else result=await supabase.auth.signInWithPassword({email,password});

    if(result.error){alert(result.error.message); return;}
    currentUser=result.data.user;
    showView('feed'); fetchPosts();
  }

  async function createPost(){
    const content=document.getElementById('post-content').value;
    if(!content.trim() || !currentUser) return;
    await supabase.from('posts').insert({content,user_id:currentUser.id});
    document.getElementById('post-content').value='';
    fetchPosts();
  }

  async function fetchPosts(){
    const {data,error}=await supabase.from('posts').select('id,content,created_at,user_id').order('created_at',{ascending:false});
    if(error){console.error(error); return;}
    posts=data;
    renderPosts();
  }

  function renderPosts(){
    const container=document.getElementById('posts-container');
    if(posts.length===0){ container.innerHTML='<p class="text-gray-500 dark:text-[var(--muted)] text-center py-12">No posts yet</p>'; return;}
    container.innerHTML=posts.map(post=>`
      <div class="post-card p-6">
        <p class="text-gray-800 dark:text-[var(--text)]">${post.content}</p>
        <p class="text-gray-500 dark:text-[var(--muted)] text-xs mt-2">${new Date(post.created_at).toLocaleDateString()}</p>
        <div class="mt-4 flex space-x-4">
          <button class="like-button flex items-center gap-2 ${userLikes.has(post.id)?'liked':''}" onclick="toggleLike('${post.id}')">
            <i class="${userLikes.has(post.id)?'fas':'far'} fa-heart"></i> ${userLikes.has(post.id)?'Unlike':'Like'}
          </button>
        </div>
      </div>
    `).join('');
  }

  async function toggleLike(postId){
    if(!currentUser) return alert('Login to like');
    if(userLikes.has(postId)){
      await supabase.from('likes').delete().eq('user_id',currentUser.id).eq('post_id',postId);
      userLikes.delete(postId);
    }else{
      await supabase.from('likes').insert({user_id:currentUser.id,post_id:postId});
      userLikes.add(postId);
    }
    renderPosts();
  }
</script>

</body>
</html>
