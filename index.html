<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TrendTime âœ¨</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --pink: #ff4d8d;
      --orange: #ff914d;
      --white: #ffffff;
      --bg: linear-gradient(135deg, var(--pink), var(--orange));
    }
    * { box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      margin: 0; padding: 0; 
      background: var(--white);
      color: #333;
    }
    header {
      background: var(--bg);
      color: var(--white);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0; z-index: 100;
    }
    header h1 { margin: 0; font-size: 1.5rem; }
    nav button {
      background: var(--white);
      border: none; border-radius: 20px;
      padding: 0.5rem 1rem;
      margin-left: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      color: var(--pink);
    }
    main {
      max-width: 700px;
      margin: 2rem auto;
      padding: 1rem;
    }
    .composer {
      background: #fff;
      border-radius: 15px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .composer textarea, .composer input {
      width: 100%;
      margin: 0.5rem 0;
      padding: 0.7rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      resize: none;
    }
    .composer button {
      background: var(--bg);
      color: var(--white);
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .feed .trend {
      background: #fff;
      border-radius: 15px;
      margin-bottom: 1.2rem;
      padding: 1rem;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }
    .feed img, .feed video {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 0.5rem;
    }
    .admin-badge {
      background: gold;
      color: #333;
      font-size: 0.75rem;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 6px;
      margin-left: 5px;
    }
    #settings {
      display: none;
      background: #fff;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <header>
    <h1>TrendTime âœ¨</h1>
    <nav>
      <button onclick="showFeed()">Feed</button>
      <button onclick="showSettings()">Settings</button>
      <button onclick="signOut()">Sign Out</button>
    </nav>
  </header>

  <main>
    <section id="composer" class="composer">
      <textarea id="captionInput" placeholder="What's trending?"></textarea>
      <input type="text" id="imagePrompt" placeholder="Type a prompt for AI image..."/>
      <button onclick="generateImage()">ðŸŽ¨ Generate Image</button>
      <button onclick="recordVideo()">ðŸŽ¥ Record Video</button>
      <button onclick="suggestCaption()">âœ¨ AI Caption</button>
      <button onclick="postTrend()">Post</button>
      <div id="preview"></div>
    </section>

    <section id="feed" class="feed"></section>
    <section id="settings">
      <h2>Settings</h2>
      <input type="file" id="avatarUpload" />
      <button onclick="updateAvatar()">Update Avatar</button>
    </section>
  </main>

  <!-- Supabase -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    const supabase = createClient("https://kpdgmbjdaynplyjacuxd.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwZGdtYmpkYXlucGx5amFjdXhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNjA3MjMsImV4cCI6MjA3NDczNjcyM30.ZJM2v_5VES_AlHAAV4lHaIID7v3IBEbFUgFEcs4yOYQ");
    let currentUser = null;
    let generatedImage = null;
    let recordedVideo = null;

    async function init() {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        const email = prompt("Enter email to sign in/signup:");
        const password = prompt("Enter password:");
        let { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) {
          await supabase.auth.signUp({ email, password });
          await supabase.auth.signInWithPassword({ email, password });
        }
      }
      currentUser = (await supabase.auth.getUser()).data.user;
      loadFeed();
    }
    init();

    async function postTrend() {
      const caption = document.getElementById("captionInput").value;
      if (!caption && !generatedImage && !recordedVideo) {
        alert("Write something or add media!");
        return;
      }
      let url = null, type = "text";
      if (generatedImage) { url = generatedImage; type = "image"; }
      if (recordedVideo) { url = recordedVideo; type = "video"; }
      let { error } = await supabase.from("trends").insert([{
        user_id: currentUser.id,
        caption, url, type,
        avatar: currentUser.email === "sonofjean2@gmail.com" ? "ðŸ‘‘" : "ðŸ™‚"
      }]);
      if (error) { alert("Post failed: " + error.message); }
      else { loadFeed(); document.getElementById("captionInput").value = ""; }
    }

    async function loadFeed() {
      let { data } = await supabase.from("trends").select("*").order("id", { ascending: false });
      const feed = document.getElementById("feed");
      feed.innerHTML = "";
      data.forEach(trend => {
        const div = document.createElement("div");
        div.className = "trend";
        div.innerHTML = `
          <strong>${trend.avatar || "ðŸ™‚"} ${trend.user_id}</strong>
          ${trend.user_id === currentUser.id && currentUser.email==="sonofjean2@gmail.com" ? '<span class="admin-badge">ADMIN</span>' : ""}
          <p>${trend.caption || ""}</p>
          ${trend.type==="image" ? `<img src="${trend.url}"/>` : ""}
          ${trend.type==="video" ? `<video controls src="${trend.url}"></video>` : ""}
        `;
        feed.appendChild(div);
      });
    }

    // AI image gen (pollinations API free frontend)
    function generateImage() {
      const prompt = document.getElementById("imagePrompt").value;
      if (!prompt) return alert("Enter prompt!");
      generatedImage = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}`;
      document.getElementById("preview").innerHTML = `<img src="${generatedImage}" />`;
    }

    // AI captions with TensorFlow.js (dummy example)
    async function suggestCaption() {
      document.getElementById("captionInput").value = "ðŸ”¥ AI thinks this will go viral!";
    }

    // Record video (frontend only)
    async function recordVideo() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      const recorder = new MediaRecorder(stream);
      let chunks = [];
      recorder.ondataavailable = e => chunks.push(e.data);
      recorder.onstop = async () => {
        const blob = new Blob(chunks, { type: "video/webm" });
        recordedVideo = URL.createObjectURL(blob);
        document.getElementById("preview").innerHTML = `<video controls src="${recordedVideo}"></video>`;
      };
      recorder.start();
      setTimeout(() => recorder.stop(), 5000); // record 5s
    }

    function showSettings() {
      document.getElementById("settings").style.display = "block";
      document.getElementById("feed").style.display = "none";
    }
    function showFeed() {
      document.getElementById("settings").style.display = "none";
      document.getElementById("feed").style.display = "block";
    }
    function signOut() { supabase.auth.signOut(); location.reload(); }
    function updateAvatar() { alert("Avatar update coming soon!"); }
  </script>

  <!-- TensorFlow -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
</body>
</html>
