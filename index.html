<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TrendTime AI üî•</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#ff4d8d;
  --secondary:#ff914d;
  --dark:#1a1a1a;
  --card:#222;
  --accent:#00ffea;
  --light:#fff;
  --shadow-glow:0 0 20px rgba(255,77,141,0.4);
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:var(--dark);color:white;overflow-x:hidden;}
header{position:sticky;top:0;width:100%;z-index:100;background:linear-gradient(90deg,var(--primary),var(--secondary));display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;box-shadow:0 4px 20px rgba(0,0,0,0.6);}
header h1{font-size:1.8rem;font-weight:700;letter-spacing:1px;text-shadow:0 0 15px rgba(0,0,0,0.5);}
header button{background:white;color:var(--dark);border:none;padding:0.5rem 1rem;border-radius:999px;cursor:pointer;font-weight:bold;transition:0.3s;}
header button:hover{background:var(--secondary);color:white;transform:scale(1.05);transition:0.3s;}

/* Modal */
.modal-bg{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.75);display:none;justify-content:center;align-items:center;z-index:500;animation:fadeIn 0.4s;}
.modal{background:var(--card);padding:2rem;border-radius:15px;width:90%;max-width:400px;box-shadow:var(--shadow-glow);position:relative;animation:slideUp 0.4s;}
@keyframes slideUp{0%{transform:translateY(50px);opacity:0;}100%{transform:translateY(0);opacity:1;}}
@keyframes fadeIn{0%{opacity:0;}100%{opacity:1;}}
.modal h2{color:var(--accent);margin-bottom:1rem;text-align:center;}
.modal input, .modal textarea, .modal button{width:100%;margin:0.5rem 0;padding:0.8rem;border-radius:10px;border:none;background:#222;color:white;}
.modal input::placeholder, .modal textarea::placeholder{color:#aaa;}
.modal button{cursor:pointer;background:linear-gradient(145deg,var(--primary),var(--secondary));color:white;font-weight:bold;transition:0.3s;box-shadow:0 0 10px rgba(255,30,100,0.6);}
.modal button:hover{opacity:0.9;transform:scale(1.03);}
.modal .close-btn{position:absolute;top:10px;right:10px;background:red;color:white;width:30px;height:30px;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer;font-weight:bold;}

/* Feed */
.feed{display:flex;flex-direction:column;gap:2rem;padding:1rem;max-width:900px;margin:auto;}
.trend-card{background:var(--card);border-radius:1.5rem;overflow:hidden;position:relative;box-shadow:var(--shadow-glow);transition:0.3s;}
.trend-card:hover{transform:scale(1.02);}
.trend-card video,.trend-card img{width:100%;height:60vh;object-fit:cover;border-radius:1.5rem;}
.trend-info{margin-top:0.5rem;padding:0 1rem;}
.trend-info h2{font-size:1.3rem;margin-bottom:0.3rem;color:var(--primary);}
.trend-info p{font-size:1rem;color:#ccc;margin-bottom:0.5rem;}
.trend-actions{display:flex;gap:1rem;padding:0 1rem;margin-bottom:0.5rem;}
.action-btn{background:linear-gradient(145deg,var(--primary),var(--secondary));width:45px;height:45px;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:1.2rem;cursor:pointer;box-shadow:var(--shadow-glow);transition:transform 0.2s;}
.action-btn:hover{transform:scale(1.1);}

/* Post button */
.post-btn{position:fixed;bottom:2rem;right:2rem;background:linear-gradient(145deg,var(--secondary),var(--primary));color:white;font-size:1.6rem;width:70px;height:70px;border-radius:50%;display:flex;justify-content:center;align-items:center;box-shadow:0 0 25px rgba(255,30,100,0.9);cursor:pointer;transition:all 0.3s ease;z-index:200;animation:pulse 2s infinite;}
@keyframes pulse{0%{box-shadow:0 0 15px rgba(255,77,141,0.6);}50%{box-shadow:0 0 35px rgba(255,30,100,1);}100%{box-shadow:0 0 15px rgba(255,77,141,0.6);}}

/* Responsive */
@media(max-width:600px){.trend-card video,.trend-card img{height:40vh;}}
</style>
</head>
<body>

<header>
  <h1>üî• TrendTime AI</h1>
  <button id="loginBtn">Login / Signup</button>
</header>

<!-- Login Modal -->
<div class="modal-bg" id="loginModal">
  <div class="modal">
    <div class="close-btn" id="closeLogin">√ó</div>
    <h2>Login / Signup</h2>
    <input type="email" id="loginEmail" placeholder="Your Email"/>
    <button id="magicLinkBtn">Send Magic Link</button>
    <p style="font-size:0.85rem;color:#aaa;margin-top:0.5rem;text-align:center;">You will receive a magic link via email</p>
  </div>
</div>

<!-- Post Modal -->
<div class="modal-bg" id="postModal">
  <div class="modal">
    <div class="close-btn" id="closePost">√ó</div>
    <h2>Post a Trend</h2>
    <textarea id="postCaption" placeholder="Caption..."></textarea>
    <input type="text" id="postPrompt" placeholder="AI Image Prompt..."/>
    <button id="generateImage">Generate Image</button>
    <div id="postPreview" style="margin-top:1rem;"></div>
    <button id="submitPost">Post Trend</button>
  </div>
</div>

<main class="feed"></main>
<div class="post-btn" id="openPostBtn">‚ûï</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabaseUrl="https://kpdgmbjdaynplyjacuxd.supabase.co";
const supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwZGdtYmpkYXlucGx5amFjdXhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNjA3MjMsImV4cCI6MjA3NDczNjcyM30.ZJM2v_5VES_AlHAAV4lHaIID7v3IBEbFUgFEcs4yOYQ";
const supabase=createClient(supabaseUrl,supabaseKey);

const loginBtn=document.getElementById("loginBtn");
const loginModal=document.getElementById("loginModal");
const closeLogin=document.getElementById("closeLogin");
const magicLinkBtn=document.getElementById("magicLinkBtn");
const loginEmail=document.getElementById("loginEmail");

const openPostBtn=document.getElementById("openPostBtn");
const postModal=document.getElementById("postModal");
const closePost=document.getElementById("closePost");
const postCaption=document.getElementById("postCaption");
const postPrompt=document.getElementById("postPrompt");
const generateImageBtn=document.getElementById("generateImage");
const postPreview=document.getElementById("postPreview");
const submitPost=document.getElementById("submitPost");

const feed=document.querySelector(".feed");
let currentUser=null;
let generatedImage=null;

// Modal toggles
loginBtn.onclick=()=>loginModal.style.display="flex";
closeLogin.onclick=()=>loginModal.style.display="none";
openPostBtn.onclick=()=>postModal.style.display="flex";
closePost.onclick=()=>{postModal.style.display="none"; postPreview.innerHTML=""; generatedImage=null;};

// Auth state listener
supabase.auth.onAuthStateChange((_event, session) => {
  if(session?.user){
    currentUser=session.user;
    loginBtn.textContent="Logged in as " + (currentUser.email.split("@")[0]);
    loginModal.style.display="none";
    loadFeed();
  }else{
    currentUser=null;
    loginBtn.textContent="Login / Signup";
  }
});

// Send Magic Link
magicLinkBtn.onclick=async()=>{
  const email=loginEmail.value.trim();
  if(!email){alert("Enter email"); return;}
  const { error } = await supabase.auth.signInWithOtp({email});
  if(error){alert(error.message);} else{alert("Check your email for the magic link");}
}

// AI image generation
generateImageBtn.onclick=()=>{
  const prompt=postPrompt.value.trim();
  if(!prompt){alert("Enter prompt"); return;}
  generatedImage=`https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}`;
  postPreview.innerHTML=`<img src="${generatedImage}" style="width:100%;border-radius:10px;">`;
}

// Post trend
submitPost.onclick=async()=>{
  if(!currentUser){alert("Login first"); return;}
  let url=generatedImage||null;
  if(url){
    const resp=await fetch(url);
    const blob=await resp.blob();
    const fileName=`image-${Date.now()}.png`;
    const { error }=await supabase.storage.from("trend-media").upload(fileName,blob,{upsert:true});
    if(error){alert(error.message); return;}
    url=supabase.storage.from("trend-media").getPublicUrl(fileName).data.publicUrl;
    generatedImage=null;
  }
  const caption=postCaption.value.trim();
  await supabase.from("trends").insert([{username:currentUser.email.split("@")[0],url,caption,type:"image"}]);
  postCaption.value=""; postPrompt.value=""; postPreview.innerHTML=""; postModal.style.display="none";
  alert("Trend posted!");
  loadFeed();
}

// Load feed
async function loadFeed(){
  const { data,error }=await supabase.from("trends").select("*").order("created_at",{ascending:false});
  if(error){console.error(error); return;}
  feed.innerHTML="";
  data.forEach(post=>{
    const card=document.createElement("div");
    card.className="trend-card";
    if(post.type==="image") card.innerHTML=`<img src="${post.url}">`;
    if(post.type==="video") card.innerHTML=`<video src="${post.url}" autoplay muted loop></video>`;
    const info=document.createElement("div");
    info.className="trend-info";
    info.innerHTML=`<h2>@${post.username||"anon"}</h2><p>${post.caption||""}</p>`;
    const actions=document.createElement("div");
    actions.className="trend-actions";
    actions.innerHTML=`<div class="action-btn">‚ù§Ô∏è</div><div class="action-btn">üí¨</div>`;
    card.appendChild(info); card.appendChild(actions);
    feed.appendChild(card);
  });
}

loadFeed();
</script>
</body>
</html>
