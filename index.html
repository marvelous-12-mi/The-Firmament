<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üî• TrendTime</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
:root {
  --orange:#ff6a00; --pink:#ff1f71; --dark:#0f0f0f; --card:#1a1a1a;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:var(--dark);color:white;overflow:hidden;}

/* Navbar */
header{position:fixed;top:0;width:100%;display:flex;justify-content:space-between;align-items:center;padding:.7rem 1rem;background:linear-gradient(90deg,var(--orange),var(--pink));box-shadow:0 4px 20px rgba(0,0,0,.6);z-index:100;}
header h1{font-size:1.5rem;font-weight:700;color:white;}
header button{background:white;color:var(--dark);border:none;padding:.5rem 1rem;border-radius:999px;font-weight:bold;cursor:pointer;transition:.3s;}
header button:hover{background:var(--pink);color:white;}

/* Side Panel */
.side-panel{position:fixed;top:0;left:-300px;width:280px;height:100vh;background:var(--card);padding:2rem 1rem;display:flex;flex-direction:column;gap:1rem;transition:left .3s;z-index:200;}
.side-panel.active{left:0;}
.side-panel input{width:100%;padding:.5rem;border:none;border-radius:8px;background:rgba(255,255,255,.05);color:#fff;}
.side-panel button{width:100%;padding:.5rem;border:none;border-radius:8px;cursor:pointer;background:linear-gradient(145deg,var(--orange),var(--pink));color:white;font-weight:600;}

/* Swipe Feed */
.feed{width:100%;height:100vh;overflow:hidden;position:relative;}
.trend-card{position:absolute;top:0;left:0;width:100%;height:100vh;background:var(--card);display:flex;align-items:flex-end;justify-content:center;overflow:hidden;transition:transform .5s ease;}
.trend-card video,.trend-card iframe{width:100%;height:100%;object-fit:cover;}
.trend-info{position:absolute;bottom:4rem;left:1rem;color:white;text-shadow:0 0 10px black;}
.trend-info h2{font-size:1.5rem;margin-bottom:.3rem;}
.trend-info p{font-size:1.1rem;}
.trend-actions{position:absolute;right:1rem;bottom:20%;display:flex;flex-direction:column;gap:1.2rem;align-items:center;}
.action-btn{background:linear-gradient(145deg,var(--orange),var(--pink));width:55px;height:55px;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:1.3rem;cursor:pointer;box-shadow:0 0 15px rgba(255,106,0,.8);transition:transform .2s;}
.action-btn:hover{transform:scale(1.1);}

/* Floating Post Button */
.post-btn{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);background:linear-gradient(145deg,var(--pink),var(--orange));color:white;font-size:1.5rem;width:70px;height:70px;border-radius:50%;display:flex;justify-content:center;align-items:center;box-shadow:0 0 25px rgba(255,30,100,.9);cursor:pointer;transition:all .3s ease;z-index:200;animation:pulse 2s infinite;}
@keyframes pulse{0%{box-shadow:0 0 15px rgba(255,106,0,.6);}50%{box-shadow:0 0 35px rgba(255,30,100,1);}100%{box-shadow:0 0 15px rgba(255,106,0,.6);}}

/* Auth Modal */
.auth-modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;justify-content:center;align-items:center;z-index:300;}
.auth-content{background:var(--card);padding:2rem;border-radius:16px;width:320px;display:flex;flex-direction:column;gap:1rem;}
.auth-content input{padding:.8rem;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.05);color:#fff;}
.auth-content button{background:linear-gradient(90deg,var(--orange),var(--pink));padding:.8rem;font-weight:700;border:none;border-radius:12px;cursor:pointer;color:white;}
</style>
</head>
<body>
<header>
  <button id="menuBtn">‚ò∞</button>
  <h1>üî• TrendTime</h1>
  <button id="authBtn">Login</button>
</header>

<div class="side-panel" id="sidePanel">
  <h2>Welcome!</h2>
  <p id="userEmail">Not logged in</p>
  <button id="logoutBtn">Logout</button>
  <h3>Post a Trend</h3>
  <input id="postUrl" type="text" placeholder="Video/Youtube URL">
  <input id="postCaption" type="text" placeholder="Caption">
  <button id="postSubmit">Post</button>
  <hr>
  <h3>Record Video</h3>
  <video id="recorderPreview" width="100%" controls muted style="display:none;"></video>
  <button id="startRecordingBtn">üé• Record</button>
  <button id="stopRecordingBtn" style="display:none;">‚èπÔ∏è Stop & Upload</button>
</div>

<main class="feed"></main>
<div class="post-btn" id="postBtn">‚ûï</div>

<!-- Auth Modal -->
<div class="auth-modal" id="authModal">
  <div class="auth-content">
    <h3>Sign In / Sign Up</h3>
    <input type="email" id="authEmail" placeholder="Email" required>
    <input type="password" id="authPassword" placeholder="Password" required>
    <button id="signUpBtn">Sign Up</button>
    <button id="signInBtn">Sign In</button>
    <button id="closeAuthBtn" style="background:#333;">Close</button>
  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
const supabaseUrl = "https://kpdgmbjdaynplyjacuxd.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwZGdtYmpkYXlucGx5amFjdXhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNjA3MjMsImV4cCI6MjA3NDczNjcyM30.ZJM2v_5VES_AlHAAV4lHaIID7v3IBEbFUgFEcs4yOYQ";
const supabase = createClient(supabaseUrl, supabaseKey);

// Elements
const menuBtn = document.getElementById("menuBtn");
const sidePanel = document.getElementById("sidePanel");
const authBtn = document.getElementById("authBtn");
const logoutBtn = document.getElementById("logoutBtn");
const userEmail = document.getElementById("userEmail");
const feed = document.querySelector(".feed");
const postBtn = document.getElementById("postBtn");
const postUrl = document.getElementById("postUrl");
const postCaption = document.getElementById("postCaption");
const postSubmit = document.getElementById("postSubmit");

const authModal = document.getElementById("authModal");
const authEmail = document.getElementById("authEmail");
const authPassword = document.getElementById("authPassword");
const signUpBtn = document.getElementById("signUpBtn");
const signInBtn = document.getElementById("signInBtn");
const closeAuthBtn = document.getElementById("closeAuthBtn");

const startRecordingBtn = document.getElementById("startRecordingBtn");
const stopRecordingBtn = document.getElementById("stopRecordingBtn");
const recorderPreview = document.getElementById("recorderPreview");
let mediaRecorder, recordedChunks = [];

// Side Panel
menuBtn.addEventListener("click", ()=>sidePanel.classList.toggle("active"));
document.addEventListener("click", e=>{if(sidePanel.classList.contains("active")&&!sidePanel.contains(e.target)&&e.target!==menuBtn){sidePanel.classList.remove("active");}});

// Auth
authBtn.addEventListener("click", ()=>authModal.style.display="flex");
closeAuthBtn.addEventListener("click", ()=>authModal.style.display="none");

signUpBtn.addEventListener("click", async()=>{
  const email = authEmail.value.trim();
  const password = authPassword.value.trim();
  if(!email||!password)return alert("Enter email & password");
  const {error} = await supabase.auth.signUp({email,password});
  if(error)return alert("Sign Up Error: "+error.message);
  alert("‚úÖ Sign Up successful! Check email."); authModal.style.display="none"; handleAuth();
});

signInBtn.addEventListener("click", async()=>{
  const email = authEmail.value.trim();
  const password = authPassword.value.trim();
  if(!email||!password)return alert("Enter email & password");
  const {error} = await supabase.auth.signInWithPassword({email,password});
  if(error)return alert("Sign In Error: "+error.message);
  authModal.style.display="none"; handleAuth();
});

logoutBtn.addEventListener("click", async()=>{await supabase.auth.signOut(); handleAuth();});

async function handleAuth(){
  const {data} = await supabase.auth.getSession();
  const user = data.session?.user;
  if(user){userEmail.textContent=user.email; authBtn.style.display="none"; logoutBtn.style.display="block";}
  else{userEmail.textContent="Not logged in"; authBtn.style.display="block"; logoutBtn.style.display="none";}
}
supabase.auth.onAuthStateChange((_e,s)=>handleAuth());

// Load Feed
let posts = [], currentIndex = 0;
async function loadFeed(){
  const {data:trends,error} = await supabase.from("trends").select("*").order("created_at",{ascending:false});
  if(error){console.error(error.message); return;}
  posts = trends; currentIndex = 0;
  feed.innerHTML="";
  posts.forEach((post,i)=>{
    const card=document.createElement("div"); card.className="trend-card";
    card.style.transform=`translateY(${i*100}%)`;
    let media;
    if(post.type==="youtube"){media=document.createElement("iframe"); media.src=post.url; media.allowFullscreen=true;}
    else{media=document.createElement("video"); media.src=post.url; media.loop=true; media.muted=true;}
    card.appendChild(media);
    const info=document.createElement("div"); info.className="trend-info"; info.innerHTML=`<h2>@${post.username||"anon"}</h2><p>${post.caption||""}</p>`; card.appendChild(info);
    const actions=document.createElement("div"); actions.className="trend-actions"; actions.innerHTML=`<div class="action-btn">‚ù§Ô∏è</div><div class="action-btn">üí¨</div><div class="action-btn">üîó</div>`; card.appendChild(actions);
    feed.appendChild(card);
  });
  playCurrentVideo();
}

// Swipe Feed
let startY = 0;
feed.addEventListener("touchstart", e=>{startY=e.touches[0].clientY;});
feed.addEventListener("touchend", e=>{
  const endY = e.changedTouches[0].clientY;
  if(endY-startY>50) prevVideo();
  if(startY-endY>50) nextVideo();
});

function updateFeedPosition(){
  const cards=document.querySelectorAll(".trend-card");
  cards.forEach((card,i)=>{
    card.style.transform=`translateY(${(i-currentIndex)*100}%)`;
  });
  playCurrentVideo();
}

function nextVideo(){if(currentIndex<posts.length-1){currentIndex++; updateFeedPosition();}}
function prevVideo(){if(currentIndex>0){currentIndex--; updateFeedPosition();}}

function playCurrentVideo(){
  document.querySelectorAll(".trend-card video").forEach((v,i)=>{if(i===currentIndex)v.play().catch(()=>{});else v.pause();});
}

// Post
postSubmit.addEventListener("click", async()=>{
  const session=(await supabase.auth.getSession()).data.session;
  if(!session){alert("Login first!"); return;}
  const url=postUrl.value.trim(); const caption=postCaption.value.trim();
  if(!url)return alert("Enter video/YouTube URL");
  const type=url.includes("youtube.com")?"youtube":"video";
  const {error}=await supabase.from("trends").insert([{url,caption,type,username:session.user.email.split("@")[0]}]);
  if(error)console.error(error.message); else {postUrl.value=""; postCaption.value=""; loadFeed();}
});

// Floating Post Button
postBtn.addEventListener("click", ()=>sidePanel.classList.add("active"));

// Initialize
handleAuth(); loadFeed();
</script>
</body>
</html>
