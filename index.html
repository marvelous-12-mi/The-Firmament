<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TrendTime</title>
<link rel="icon" href="https://placehold.co/32x32/ff6a00/ffffff?text=T" type="image/png" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
:root {
  --orange: #ff6a00;
  --dark: #0a0a0a;
  --card: rgba(30, 30, 30, 0.75);
  --text: #f5f5f5;
  --gray: #aaa;
  --border: rgba(255,255,255,0.1);
  --neon: 0 0 15px rgba(255,106,0,0.8);
}
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at top left, #1a1a1a, #000);
  color: var(--text);
  overflow-x: hidden;
}
.navbar {
  background: rgba(15,15,15,0.8);
  backdrop-filter: blur(12px);
  padding: 1rem 2rem;
  display:flex; justify-content:space-between; align-items:center;
  border-bottom:1px solid var(--border);
  position:sticky; top:0; z-index:1000;
}
.nav-logo {
  font-size:2rem; font-weight:800; 
  background: linear-gradient(45deg, var(--orange), #ffdd00);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow: var(--neon);
}
.nav-actions { display:flex; gap:1rem; align-items:center; }
.nav-actions button {
  background: linear-gradient(45deg, var(--orange), #ff9500);
  color:#fff; border:none; border-radius:10px;
  padding:0.6rem 1.2rem; font-weight:600;
  cursor:pointer; box-shadow: var(--neon);
  transition: all 0.3s ease;
}
.nav-actions button:hover {
  transform: scale(1.08) translateY(-2px);
  box-shadow:0 0 25px rgba(255,106,0,0.9);
}
.nav-actions img {
  width:40px; height:40px; border-radius:50%;
  object-fit:cover; border:2px solid var(--orange);
  box-shadow: var(--neon);
}
main { max-width:800px; margin:auto; padding:2rem 1rem; }

/* Composer */
.composer {
  margin-bottom:2rem;
  background:var(--card);
  padding:1.5rem;
  border-radius:20px;
  backdrop-filter: blur(15px);
  box-shadow: 0 0 25px rgba(255,106,0,0.3);
  animation: floatUp 0.8s ease;
}
form { display:flex; flex-direction:column; gap:1rem; }
textarea,input {
  background: rgba(255,255,255,0.05);
  border:1px solid var(--border);
  border-radius:12px;
  padding:1rem;
  color:#fff;
  font-size:1rem;
}
textarea:focus, input:focus {
  outline:none; border:1px solid var(--orange);
  box-shadow: 0 0 10px rgba(255,106,0,0.5);
}
button[type="submit"] {
  background:linear-gradient(90deg, var(--orange), #ffbb00);
  border:none; border-radius:12px;
  padding:0.8rem;
  font-weight:700; color:#fff;
  cursor:pointer;
  transition:all 0.3s ease;
  box-shadow: var(--neon);
}
button[type="submit"]:hover {
  transform: scale(1.05);
  box-shadow:0 0 25px rgba(255,106,0,1);
}

/* Feed */
.feed { display:flex; flex-direction:column; gap:2rem; }
.trend-card {
  background: var(--card);
  border-radius:20px;
  padding:1rem 1.5rem;
  box-shadow: 0 0 25px rgba(0,0,0,0.7);
  display:flex; flex-direction:column; gap:1rem;
  animation: fadeIn 0.7s ease forwards;
  position:relative;
}
.trend-card::before {
  content:"";
  position:absolute;
  inset:0;
  border-radius:20px;
  padding:2px;
  background: linear-gradient(45deg, var(--orange), #ffbb00);
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude; 
}
.trend-header { display:flex; align-items:center; gap:0.8rem; }
.trend-header img {
  width:45px; height:45px; border-radius:50%;
  border:2px solid var(--orange);
}
.trend-user { font-weight:700; font-size:1rem; }
.trend-text { font-size:1.05rem; }
.trend-card video, .trend-card iframe {
  width:100%; border-radius:12px;
  max-height:400px; object-fit:cover;
}
.trend-actions {
  display:flex; gap:1.5rem; margin-top:0.5rem;
}
.trend-actions button {
  background:none; border:none; color:var(--gray);
  cursor:pointer; font-size:1.1rem;
  transition: color 0.2s;
}
.trend-actions button:hover { color:var(--orange); }

/* Auth Modal */
.auth-modal {
  position:fixed; inset:0;
  background:rgba(0,0,0,0.85);
  display:flex; justify-content:center; align-items:center;
  z-index:2000; display:none;
}
.auth-content {
  background:var(--card);
  padding:2rem;
  border-radius:16px;
  width:320px;
  display:flex; flex-direction:column; gap:1rem;
  box-shadow:0 0 25px rgba(255,106,0,0.5);
}
.auth-content h3 {
  background: linear-gradient(90deg,var(--orange),#ffdd00);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-align:center;
}
.auth-content input {
  padding:0.8rem;
  border-radius:10px;
  border:1px solid var(--border);
  background:rgba(255,255,255,0.05);
  color:#fff;
}
.auth-content button {
  background:linear-gradient(90deg,var(--orange),#ffbb00);
  padding:0.8rem;
  font-weight:700;
  border:none; border-radius:12px;
  cursor:pointer;
}
.auth-content button:hover {
  box-shadow:0 0 20px rgba(255,106,0,0.7);
}

/* Footer */
footer {
  text-align:center; padding:2rem 1rem;
  font-size:0.85rem; color:var(--gray);
  margin-top:3rem;
}

/* Animations */
@keyframes fadeIn {
  from { opacity:0; transform:translateY(15px); }
  to { opacity:1; transform:translateY(0); }
}
@keyframes floatUp {
  from { transform:translateY(20px); opacity:0; }
  to { transform:translateY(0); opacity:1; }
}
</style>
</head>
<body>
<nav class="navbar">
  <div class="nav-logo">TrendTime</div>
  <div class="nav-actions">
    <img id="avatar" src="" alt="Profile" style="display:none;" />
    <button id="openAuthBtn">Sign In / Sign Up</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</nav>

<main>
<section class="composer" id="composerSection" style="display:none;">
  <form id="trendForm">
    <textarea id="trendText" placeholder="🔥 What's trending?" required></textarea>
    <input type="url" id="videoUrl" placeholder="🎬 Video URL or YouTube link" />
    <button type="submit">Post 🚀</button>
  </form>
</section>

<section id="trendFeed" class="feed"></section>
</main>

<!-- Auth Modal -->
<div class="auth-modal" id="authModal">
  <div class="auth-content">
    <h3>Sign In / Sign Up</h3>
    <input type="email" id="authEmail" placeholder="Email" required />
    <input type="password" id="authPassword" placeholder="Password" required />
    <button id="signUpBtn">Sign Up</button>
    <button id="signInBtn">Sign In</button>
    <button id="closeAuthBtn" style="background:#333;">Close</button>
  </div>
</div>

<footer>&copy; 2025 TrendTime ⚡ The Future of Social Sharing</footer>

<!-- keep your same script block -->
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

// --- Supabase client ---
const supabase = createClient(
  'https://kpdgmbjdaynplyjacuxd.supabase.co', // your project URL
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwZGdtYmpkYXlucGx5amFjdXhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNjA3MjMsImV4cCI6MjA3NDczNjcyM30.ZJM2v_5VES_AlHAAV4lHaIID7v3IBEbFUgFEcs4yOYQ'                     // your anon key
)

// --- DOM elements ---
const openAuthBtn = document.getElementById("openAuthBtn")
const authModal = document.getElementById("authModal")
const closeAuthBtn = document.getElementById("closeAuthBtn")
const signUpBtn = document.getElementById("signUpBtn")
const signInBtn = document.getElementById("signInBtn")
const authEmail = document.getElementById("authEmail")
const authPassword = document.getElementById("authPassword")
const logoutBtn = document.getElementById("logoutBtn")
const avatar = document.getElementById("avatar")
const composerSection = document.getElementById("composerSection")
const trendForm = document.getElementById("trendForm")
const feed = document.getElementById("trendFeed")

// --- Premium button (frontend unlock) ---
const premiumBtn = document.createElement("button")
premiumBtn.textContent = "⭐ Unlock Premium"
premiumBtn.style.marginLeft = "1rem"
premiumBtn.onclick = unlockPremium

// --- Event handlers ---
openAuthBtn.onclick = () => authModal.style.display = "flex"
closeAuthBtn.onclick = () => authModal.style.display = "none"

// Sign Up
signUpBtn.onclick = async () => {
  const email = authEmail.value.trim()
  const password = authPassword.value.trim()
  if(!email || !password) return alert("Enter email & password")
  const { error } = await supabase.auth.signUp({ email, password })
  if(error) return alert("Sign Up Error: "+error.message)
  alert("Sign Up successful! Check email if verification required.")
  authModal.style.display="none"
  handleAuth()
}

// Sign In
signInBtn.onclick = async () => {
  const email = authEmail.value.trim()
  const password = authPassword.value.trim()
  if(!email || !password) return alert("Enter email & password")
  const { error } = await supabase.auth.signInWithPassword({ email, password })
  if(error) return alert("Sign In Error: "+error.message)
  authModal.style.display="none"
  handleAuth()
}

// Logout
logoutBtn.onclick = async () => {
  await supabase.auth.signOut()
  handleAuth()
}

// --- Handle user session ---
async function handleAuth() {
  const { data } = await supabase.auth.getSession()
  const user = data.session?.user
  if(user){
    avatar.style.display = "inline-block"
    avatar.src = user.user_metadata?.avatar_url || "https://placehold.co/36x36"
    logoutBtn.style.display = "inline-block"
    openAuthBtn.style.display = "none"
    composerSection.style.display = "block"

    // Add premium button
    if(!document.getElementById("premiumBtn")) {
      premiumBtn.id = "premiumBtn"
      document.querySelector(".nav-actions").appendChild(premiumBtn)
    }

    await ensureProfile(user)
    checkPremium(user)
  } else {
    avatar.style.display = "none"
    logoutBtn.style.display = "none"
    openAuthBtn.style.display = "inline-block"
    composerSection.style.display = "none"
    const btn = document.getElementById("premiumBtn")
    if(btn) btn.remove()
    document.body.classList.remove("premium")
  }
}

// --- Ensure profile exists ---
async function ensureProfile(user){
  const { data: existing } = await supabase.from("profiles").select().eq("id", user.id).single()
  if(!existing) await supabase.from("profiles").insert([{ id:user.id, username:"Anonymous", avatar_url:"", is_premium:false }])
}

// --- Check premium status ---
async function checkPremium(user){
  const { data: profile } = await supabase.from("profiles").select("is_premium").eq("id", user.id).single()
  if(profile?.is_premium){
    document.body.classList.add("premium")
    premiumBtn.textContent = "⭐ Premium Active"
    premiumBtn.disabled = true
  }
}

// --- Unlock premium ---
async function unlockPremium(){
  const { data: { session } } = await supabase.auth.getSession()
  const user = session?.user
  if(!user) return alert("Sign in first!")

  const { error } = await supabase.from("profiles").update({ is_premium:true }).eq("id", user.id)
  if(error) alert("Error unlocking premium: "+error.message)
  else {
    alert("✅ Premium Unlocked!")
    document.body.classList.add("premium")
    premiumBtn.textContent = "⭐ Premium Active"
    premiumBtn.disabled = true
  }
}

// --- Posting trends ---
trendForm.addEventListener("submit", async e=>{
  e.preventDefault()
  const { data:{ session } } = await supabase.auth.getSession()
  const user = session?.user
  if(!user) return alert("Sign in first")
  const text = document.getElementById("trendText").value.trim()
  const video_url = document.getElementById("videoUrl").value.trim()
  await ensureProfile(user)
  const { error } = await supabase.from("trends").insert([{ text, video_url:video_url||null, user_id:user.id }])
  if(error) alert("Error posting: "+error.message)
  else trendForm.reset(), loadTrends()
})

// --- Load trends ---
async function loadTrends(){
  const { data: trends, error } = await supabase.from("trends").select("id,text,video_url,user_id").order("id",{ascending:false})
  if(error) return console.error(error)
  feed.innerHTML=""
  for(const trend of trends){
    let profile={username:"Anonymous", avatar_url:"https://placehold.co/40x40"}
    const { data: profileData } = await supabase.from("profiles").select("username,avatar_url").eq("id",trend.user_id).single()
    if(profileData) profile=profileData
    renderTrend(trend, profile)
  }
}

// --- Render trend ---
function isYouTube(url){ return url.includes("youtube.com") || url.includes("youtu.be") }
function renderTrend(trend, profile){
  const card = document.createElement("div"); card.className="trend-card"
  const header = document.createElement("div"); header.className="trend-header"
  const userAvatar = document.createElement("img"); userAvatar.src = profile?.avatar_url || "https://placehold.co/40x40"
  header.appendChild(userAvatar)
  const userTag = document.createElement("div"); userTag.className="trend-user"; userTag.textContent = profile?.username || "Anonymous"
  header.appendChild(userTag); card.appendChild(header)
  const textEl = document.createElement("div"); textEl.className="trend-text"; textEl.textContent = trend.text; card.appendChild(textEl)
  if(trend.video_url){
    if(isYouTube(trend.video_url)){
      let id = trend.video_url.includes("youtu.be") ? trend.video_url.split("/").pop() : new URL(trend.video_url).searchParams.get("v")
      const iframe = document.createElement("iframe")
      iframe.src=`https://www.youtube.com/embed/${id}`
      iframe.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      iframe.allowFullscreen=true
      iframe.height=300
      card.appendChild(iframe)
    } else {
      const video = document.createElement("video"); video.src=trend.video_url; video.controls=true; video.muted=true
      video.onmouseenter=()=>video.play(); video.onmouseleave=()=>video.pause()
      card.appendChild(video)
    }
  }
  feed.prepend(card)
}

// --- Realtime updates ---
supabase.channel("realtime-trends").on("postgres_changes",{event:"INSERT", schema:"public", table:"trends"}, async payload=>{
  const trend = payload.new
  let profile={username:"Anonymous", avatar_url:"https://placehold.co/40x40"}
  const { data: profileData } = await supabase.from("profiles").select("username,avatar_url").eq("id",trend.user_id).single()
  if(profileData) profile=profileData
  renderTrend(trend, profile)
}).subscribe()

// --- Initial load ---
handleAuth()
loadTrends()

</script>
</body>
</html>


