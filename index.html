<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TrendTime AI üî•</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #ff4d6d;
  --secondary: #1e90ff;
  --accent: #00c896;
  --light: #ffffff;
  --dark: #111111;
  --gray: #f4f4f4;
}

* {
  margin: 0; padding: 0; box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: var(--light);
  color: var(--dark);
  overflow-x: hidden;
}

/* Header */
header {
  position: sticky; top: 0; z-index: 100;
  width: 100%;
  display: flex; justify-content: space-between; align-items: center;
  padding: 1rem 1.5rem;
  background: var(--light);
  border-bottom: 1px solid #eee;
  box-shadow: 0 3px 15px rgba(0,0,0,0.05);
}
header h1 {
  font-size: 1.5rem; font-weight: 700;
  background: linear-gradient(45deg, var(--primary), var(--secondary));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
header button {
  background: linear-gradient(145deg, var(--primary), var(--secondary));
  color: white; border: none;
  padding: 0.5rem 1.2rem; border-radius: 999px;
  font-weight: bold; cursor: pointer;
  transition: 0.3s;
}
header button:hover { opacity: 0.85; }

/* Side Panel */
.side-panel {
  position: fixed; top: 0; left: -400px; height: 100vh; width: 360px;
  background: var(--gray); box-shadow: 5px 0 25px rgba(0,0,0,0.2);
  transition: left 0.3s ease; padding: 2rem; z-index: 200;
  overflow-y: auto;
}
.side-panel.active { left: 0; }
.side-panel h2, .side-panel h3 { margin-bottom: 1rem; color: var(--primary); }
.side-panel input, .side-panel select, .side-panel button {
  margin: 0.5rem 0; padding: 0.8rem; width: 100%;
  border-radius: 10px; border: 1px solid #ddd;
  background: #fff; color: #333;
}
.side-panel input::placeholder { color: #aaa; }
.side-panel button {
  background: linear-gradient(145deg, var(--primary), var(--secondary));
  border: none; color: white;
  font-weight: bold; cursor: pointer;
}
.side-panel button:hover { opacity: 0.9; }

/* Feed */
.feed {
  display: flex; flex-direction: column; gap: 2rem;
  padding: 1rem; max-width: 700px; margin: 2rem auto;
}
.trend-card {
  background: white;
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 8px 25px rgba(0,0,0,0.08);
  transition: transform 0.2s;
}
.trend-card:hover { transform: scale(1.01); }
.trend-card video, .trend-card img {
  width: 100%; border-bottom: 1px solid #eee; max-height: 60vh; object-fit: cover;
}
.trend-info { padding: 1rem; }
.trend-info h2 { font-size: 1.2rem; margin-bottom: 0.4rem; color: var(--secondary); }
.trend-info p { color: #555; font-size: 0.95rem; }

/* Actions */
.trend-actions {
  display: flex; gap: 1rem; padding: 0 1rem 1rem;
}
.action-btn {
  background: linear-gradient(145deg, var(--primary), var(--secondary));
  width: 45px; height: 45px; border-radius: 50%;
  display: flex; justify-content: center; align-items: center;
  font-size: 1.2rem; cursor: pointer; color: white;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  transition: transform 0.2s;
}
.action-btn:hover { transform: scale(1.1); }

/* Post floating button */
.post-btn {
  position: fixed; bottom: 2rem; right: 2rem;
  width: 70px; height: 70px; border-radius: 50%;
  display: flex; justify-content: center; align-items: center;
  font-size: 1.8rem; color: white;
  background: linear-gradient(145deg, var(--secondary), var(--primary));
  cursor: pointer; z-index: 200;
  box-shadow: 0 0 25px rgba(0,0,0,0.25);
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%{transform:scale(1);} 50%{transform:scale(1.05);} 100%{transform:scale(1);}
}
</style>
</head>
<body>

<header>
  <button id="menuBtn">‚ò∞</button>
  <h1>TrendTime AI</h1>
  <button id="authBtn">Login</button>
</header>

<!-- Side panel -->
<div class="side-panel" id="sidePanel">
  <h2>User Settings</h2>
  <p id="userEmail">Not logged in</p>
  <button id="logoutBtn" style="display:none;">Logout</button>

  <div class="settings-section">
    <h3>Record & Post</h3>
    <video id="preview" autoplay muted></video>
    <button id="recordBtn">üé• Start Recording</button>
    <button id="stopBtn">‚èπ Stop & Upload</button>
    <input id="postCaption" type="text" placeholder="Caption">
    <input id="postUrl" type="text" placeholder="or paste video URL">
    <button id="postSubmit">Post</button>
  </div>

  <div class="settings-section">
    <h3>Profile</h3>
    <input type="text" id="username" placeholder="Username">
    <input type="file" id="avatarUpload" accept="image/*">
    <button id="saveProfile">Save Profile</button>
  </div>

  <div class="settings-section">
    <h3>AI Tools</h3>
    <button id="aiCaptionBtn">‚ú® Generate Caption</button>
    <input type="text" id="aiPrompt" placeholder="Prompt for AI Image">
    <button id="aiImageBtn">üñº Generate Image</button>
  </div>
</div>

<!-- Feed -->
<main class="feed"></main>
<div class="post-btn" id="postBtn">‚ûï</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://kpdgmbjdaynplyjacuxd.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwZGdtYmpkYXlucGx5amFjdXhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkxNjA3MjMsImV4cCI6MjA3NDczNjcyM30.ZJM2v_5VES_AlHAAV4lHaIID7v3IBEbFUgFEcs4yOYQ"
);

const menuBtn=document.getElementById("menuBtn");
const sidePanel=document.getElementById("sidePanel");
const authBtn=document.getElementById("authBtn");
const logoutBtn=document.getElementById("logoutBtn");
const userEmail=document.getElementById("userEmail");
const feed=document.querySelector(".feed");
const preview=document.getElementById("preview");
let mediaRecorder, recordedBlobs=[];

// Menu toggle
menuBtn.addEventListener("click",()=>{sidePanel.classList.toggle("active");});

// Auth
authBtn.addEventListener("click",async()=>{
  const email=prompt("Enter email:"); const password=prompt("Enter password:");
  const { data, error } = await supabase.auth.signInWithPassword({ email, password });
  if(error) alert("Login failed: "+error.message);
});
logoutBtn.addEventListener("click",async()=>{await supabase.auth.signOut(); updateUserUI(null);});

async function updateUserUI(session){
  if(session?.user){
    userEmail.textContent=session.user.email;
    authBtn.style.display="none"; logoutBtn.style.display="block";
  } else {
    userEmail.textContent="Not logged in"; authBtn.style.display="block"; logoutBtn.style.display="none";
  }
}
supabase.auth.onAuthStateChange((_e,session)=>{updateUserUI(session); loadFeed();});

// Recording
document.getElementById("recordBtn").onclick=async()=>{
  const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
  preview.srcObject=stream; recordedBlobs=[];
  mediaRecorder=new MediaRecorder(stream);
  mediaRecorder.ondataavailable=e=>{if(e.data.size>0) recordedBlobs.push(e.data);}
  mediaRecorder.start();
  alert("Recording started!");
};
document.getElementById("stopBtn").onclick=async()=>{
  mediaRecorder.stop();
  const blob=new Blob(recordedBlobs,{type:"video/webm"});
  const file=new File([blob],"trend_"+Date.now()+".webm",{type:"video/webm"});
  const session=(await supabase.auth.getSession()).data.session;
  if(!session){alert("Login required"); return;}
  const {data,error}=await supabase.storage.from("videos").upload(file.name,file);
  if(error){alert("Upload error: "+error.message); return;}
  const url=supabase.storage.from("videos").getPublicUrl(file.name).data.publicUrl;
  await supabase.from("trends").insert([{url,caption:document.getElementById("postCaption").value||"",type:"video",username:session.user.email}]);
  alert("Video uploaded!");
  loadFeed();
};

// Post with URL
document.getElementById("postSubmit").onclick=async()=>{
  const session=(await supabase.auth.getSession()).data.session;
  if(!session){alert("Login required"); return;}
  const url=document.getElementById("postUrl").value;
  await supabase.from("trends").insert([{url,caption:document.getElementById("postCaption").value||"",type:"video",username:session.user.email}]);
  alert("Trend posted!");
  loadFeed();
};

// Load feed
async function loadFeed(){
  const {data,error}=await supabase.from("trends").select("*").order("created_at",{ascending:false});
  if(error){console.error(error); return;}
  feed.innerHTML="";
  data.forEach(post=>{
    const card=document.createElement("div"); card.className="trend-card";
    const media=document.createElement("video"); media.src=post.url; media.autoplay=true; media.loop=true; media.muted=true;
    card.appendChild(media);
    const info=document.createElement("div"); info.className="trend-info";
    info.innerHTML=`<h2>@${post.username||"anon"}</h2><p>${post.caption||""}</p>`;
    card.appendChild(info);
    const actions=document.createElement("div"); actions.className="trend-actions";
    actions.innerHTML=`<div class="action-btn">‚ù§Ô∏è</div><div class="action-btn">üí¨</div>${post.username==="sonofjean2@gmail.com"?'<div class="action-btn">üóëÔ∏è</div>':''}`;
    card.appendChild(actions);
    feed.appendChild(card);
  });
}

// AI Caption (placeholder)
document.getElementById("aiCaptionBtn").onclick=()=>{
  alert("‚ú® AI suggests: 'Vibes unmatched üî•'");
};

// AI Image
document.getElementById("aiImageBtn").onclick=()=>{
  const prompt=document.getElementById("aiPrompt").value||"aesthetic vibes";
  const url=`https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}`;
  window.open(url,"_blank");
};

loadFeed();
</script>
</body>
</html>
