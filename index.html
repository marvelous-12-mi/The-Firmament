<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TrendTime ‚Äî AI Social</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0a001f;
    --card:#1b0033;
    --muted:#9ee3f8;
    --accent1:#ff3ec5;
    --accent2:#00fff0;
    --glass: rgba(255,255,255,0.05);
  }
  *{box-sizing:border-box;font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  body{
    margin:0;
    background:linear-gradient(180deg,#0a001f,#00040f);
    color:#fff;
    min-height:100vh;
    overflow:hidden;
  }
  header{
    height:68px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 18px;
    background:linear-gradient(90deg,var(--accent1),var(--accent2));
    box-shadow:0 6px 30px rgba(0,255,255,0.2);
    position:sticky;
    top:0;
    z-index:40;
  }
  header h1{font-size:1.2rem;margin:0;letter-spacing:0.6px;text-shadow:0 0 10px #00fff0}
  header .actions{display:flex;gap:10px;align-items:center}
  button.btn{
    background:linear-gradient(90deg,var(--accent1),var(--accent2));
    color:#000;border:none;
    padding:8px 12px;
    border-radius:999px;
    font-weight:600;
    cursor:pointer;
    transition:0.2s;
  }
  button.btn:hover{filter:drop-shadow(0 0 10px var(--accent2))}
  button.icon-btn{
    background:var(--glass);
    border:1px solid rgba(255,255,255,0.06);
    color:var(--muted);
    padding:8px;
    border-radius:10px;
    cursor:pointer;
    transition:0.2s;
  }
  button.icon-btn:hover{filter:drop-shadow(0 0 10px var(--accent1))}
  /* layout */
  .app{display:grid;grid-template-columns:320px 1fr 360px;gap:18px;padding:18px;height:calc(100vh - 68px)}
  @media (max-width:1100px){ .app{grid-template-columns:1fr} .right-col{display:none} }
  .left, .right {background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.05));border-radius:14px;padding:16px;overflow:auto;box-shadow:0 10px 30px rgba(0,255,255,0.1)}
  .center{overflow:hidden;border-radius:14px;padding:6px;display:flex;flex-direction:column;gap:12px}
  /* feed */
  .feed{flex:1;overflow-y:auto;scroll-snap-type:y mandatory;padding:8px}
  .feed::-webkit-scrollbar{width:8px}
  .feed::-webkit-scrollbar-thumb{background:var(--accent2);border-radius:4px}
  .post-card{
    position:relative;
    background:var(--card);
    height:calc(100vh - 200px);
    margin-bottom:18px;
    border-radius:12px;
    overflow:hidden;
    scroll-snap-align:start;
    box-shadow:0 12px 40px rgba(0,255,255,0.2);
    transition:0.3s;
  }
  .post-card:hover{box-shadow:0 12px 40px rgba(255,30,200,0.5) inset,0 12px 40px rgba(0,255,255,0.5)}
  .post-media{width:100%;height:100%;object-fit:cover;background:#000;transition:0.3s}
  .post-media:hover{transform:scale(1.05)}
  .post-info{
    position:absolute;
    left:18px;
    bottom:18px;
    right:120px;
    padding:12px;
    background:linear-gradient(180deg, rgba(0,255,255,0.03), rgba(0,0,0,0.35));
    border-radius:10px;
  }
  .meta{display:flex;gap:12px;align-items:center}
  .avatar{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.06)}
  .username{font-weight:700}
  .caption{color:var(--muted);margin-top:6px}
  .post-controls{
    position:absolute;
    right:18px;
    bottom:18px;
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:center
  }
  .round{
    width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(145deg,var(--accent1),var(--accent2));
    box-shadow:0 4px 20px rgba(255,30,100,0.2);
    cursor:pointer;
    transition:0.2s;
  }
  .round:hover{transform:scale(1.1);box-shadow:0 4px 40px rgba(255,30,200,0.4)}
  .small{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.03);cursor:pointer;transition:0.2s}
  .small:hover{transform:scale(1.1);box-shadow:0 0 15px var(--accent2)}
  /* comments */
  .comments{margin-top:10px;background:rgba(0,0,0,0.35);padding:8px;border-radius:8px;max-height:140px;overflow:auto}
  .comment-item{padding:6px;border-bottom:1px solid rgba(255,255,255,0.02);font-size:14px}
  /* tips bubble */
  .tips-bubble{
    position:fixed;
    bottom:20px;
    left:20px;
    padding:12px 16px;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));
    border-radius:999px;
    font-weight:600;
    color:#000;
    cursor:pointer;
    box-shadow:0 4px 20px rgba(255,30,200,0.4);
    z-index:60;
    transition:0.2s;
  }
  .tips-bubble:hover{transform:scale(1.05)}
</style>
</head>
<body>

<header>
  <h1>TrendTime üåê</h1>
  <div class="actions">
    <button id="openFeedShuffle" class="icon-btn" title="Shuffle feed">üîÄ</button>
    <button id="openPostModal" class="btn">Post</button>
    <button id="openLogin" class="btn">Sign In / Sign Up</button>
  </div>
</header>

<div class="app" style="padding-top:10px">
  <aside class="left">
    <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
      <img id="leftAvatar" class="avatar" src="https://placehold.co/80x80?text=U" alt="avatar">
      <div>
        <div id="leftUsername" style="font-weight:700">Not signed in</div>
        <div class="small-muted" id="leftEmail">‚Äî</div>
      </div>
    </div>
    <div class="panel-title">Quick Actions</div>
    <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:12px">
      <button id="openRecordModal" class="btn">Record & Upload</button>
      <button id="openSettings" class="icon-btn">Settings</button>
    </div>
  </aside>

  <main class="center">
    <div style="display:flex;gap:12px;align-items:center;padding:8px">
      <h2 style="margin:0">Feed</h2>
      <div class="muted" style="margin-left:8px">Swipe / scroll to explore</div>
      <div style="margin-left:auto"><button id="refreshFeed" class="icon-btn">‚ü≥ Refresh</button></div>
    </div>
    <div class="feed" id="feedWrap" aria-live="polite"></div>
  </main>

  <aside class="right">
    <div class="panel-title">Compose (AI helpers)</div>
    <div class="field">
      <label class="small-muted">Caption</label>
      <input id="composeCaption" type="text" placeholder="Write a caption or use AI">
      <div style="display:flex;gap:8px;margin-top:6px">
        <button id="aiCaptionBtn" class="btn">‚ú® Suggest Caption</button>
        <button id="aiHashtagsBtn" class="icon-btn"># tags</button>
      </div>
    </div>
  </aside>
</div>

<div class="tips-bubble" id="tipsBubble">üí° AI Tips</div>

<!-- MODAL -->
<div id="modalBackdrop" class="modal-backdrop" style="position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:80">
  <div id="modalContainer" class="modal" style="background:var(--card);padding:18px;border-radius:12px;width:90%;max-width:520px"></div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
const supabase = createClient('https://kpdgmbjdaynplyjacuxd.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwZGdtYmpkYXlucGx5amFjdXgiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTc1OTE2MDcyMywiZXhwIjoyMDc0NzM2NzIzfQ.ZJM2v_5VES_AlHAAV4lHaIID7v3IBEbFUgFEcs4yOYQ');

const feedWrap = document.getElementById('feedWrap');
const openLoginBtn = document.getElementById('openLogin');
const refreshFeedBtn = document.getElementById('refreshFeed');
const shuffleFeedBtn = document.getElementById('openFeedShuffle');
const tipsBubble = document.getElementById('tipsBubble');
const aiCaptionBtn = document.getElementById('aiCaptionBtn');
const aiHashtagsBtn = document.getElementById('aiHashtagsBtn');
const composeCaptionInput = document.getElementById('composeCaption');

let currentUser = null;
let postsCache = [];

// ---------- AI Tips bubble ----------
tipsBubble.addEventListener('click',()=>alert('üí° Use AI Caption & Hashtags for more reach!\nüé• Record vertical clips for best results'));

// ---------- Load feed ----------
async function loadFeed(){
  const { data,error } = await supabase.from('trends').select('*').order('created_at',{ascending:false}).limit(50);
  postsCache = data||[];
  feedWrap.innerHTML = '';
  postsCache.forEach(post=>{
    const card = document.createElement('div'); card.className='post-card';
    let mediaEl;
    if(post.type==='youtube'||post.url.includes('youtube')){
      mediaEl = document.createElement('iframe');
      mediaEl.src = post.url.includes('embed') ? post.url : post.url.replace('watch?v=','embed/');
      mediaEl.setAttribute('allow','accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'); 
      mediaEl.className='post-media';
    } else {
      mediaEl = document.createElement('video');
      mediaEl.src = post.url; mediaEl.className='post-media';
      mediaEl.muted = true; mediaEl.loop = true;
    }
    card.appendChild(mediaEl);
    const info = document.createElement('div'); info.className='post-info';
    info.innerHTML = `<div class="meta"><img class="avatar" src="${post.avatar||'https://placehold.co/80x80'}"><div><div class="username">${post.username||'anon'}</div></div></div><div class="caption">${post.caption||''}</div>`;
    card.appendChild(info);
    const actions = document.createElement('div'); actions.className='post-controls';
    actions.innerHTML = `<div class="round" data-id="${post.id}">‚ù§Ô∏è ${post.likes||0}</div>
                         <div class="small" data-id="${post.id}">üí¨</div>
                         <div class="small" data-id="${post.id}">üóëÔ∏è</div>
                         <div class="small" data-id="${post.id}">ü§ñ AI</div>`;
    card.appendChild(actions);
    feedWrap.appendChild(card);
    // AI reaction button
    actions.querySelectorAll('.small').forEach(btn=>{
      btn.addEventListener('click',async e=>{
        if(btn.textContent.includes('ü§ñ')){
          btn.textContent='ü§ñ...';
          const txt = await fetch(`https://text.pollinations.ai/${encodeURIComponent('Give a fun emoji reaction')}`).then(r=>r.text());
          alert('AI reacts: '+txt);
          btn.textContent='ü§ñ AI';
        }
      });
    });
  });
}
loadFeed();
</script>
</body>
</html>

