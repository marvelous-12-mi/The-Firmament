<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TrendTime</title>
<link rel="icon" href="https://placehold.co/32x32/ff6a00/ffffff?text=T" type="image/png" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<style>
:root {
  --orange: #ff6a00;
  --dark: #0f0f0f;
  --card: #1a1a1a;
  --text: #f5f5f5;
  --gray: #999;
  --border: #333;
  --glow: 0 0 10px rgba(255,106,0,0.6);
}
* { box-sizing: border-box; }
body { margin:0; font-family:'Poppins',sans-serif; background:linear-gradient(to bottom,#0f0f0f,#1a1a1a); color:var(--text); }
.navbar { background:var(--card); padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border); position:sticky; top:0; z-index:1000; }
.nav-logo { font-size:1.8rem; font-weight:700; color:var(--orange); }
.nav-actions { display:flex; gap:1rem; align-items:center; }
.nav-actions button { background:var(--orange); color:#fff; border:none; border-radius:6px; padding:0.5rem 1rem; font-weight:600; cursor:pointer; box-shadow:var(--glow); transition:transform 0.3s; }
.nav-actions button:hover { transform:scale(1.05); }
.nav-actions img { width:36px; height:36px; border-radius:50%; border:2px solid var(--orange); display:none; }
main { max-width:700px; margin:auto; padding:2rem 1rem; }
.composer { margin-bottom:2rem; background:var(--card); padding:1rem; border-radius:12px; box-shadow:var(--glow); }
form { display:flex; flex-direction:column; gap:1rem; }
textarea,input { background:#222; border:none; border-radius:8px; padding:1rem; color:#fff; font-size:1rem; }
button[type="submit"] { background:var(--orange); color:#fff; border:none; border-radius:8px; padding:0.75rem; font-weight:600; cursor:pointer; box-shadow:var(--glow); transition:transform 0.3s; }
button[type="submit"]:hover { transform:scale(1.05); }
.feed { display:flex; flex-direction:column; gap:2rem; }
.trend-card { background:var(--card); border-radius:12px; padding:1rem; box-shadow:0 0 15px rgba(0,0,0,0.4); display:flex; flex-direction:column; gap:0.75rem; }
.trend-header { display:flex; align-items:center; gap:0.75rem; }
.trend-header img { width:40px; height:40px; border-radius:50%; border:2px solid var(--orange); }
.trend-user { font-weight:600; font-size:1rem; }
.trend-card video,.trend-card iframe { width:100%; max-height:400px; border-radius:8px; }
.floating-btn { position:fixed; bottom:20px; right:20px; background:var(--orange); color:#fff; border:none; border-radius:50%; width:56px; height:56px; font-size:2rem; font-weight:bold; cursor:pointer; box-shadow:var(--glow); z-index:1001; }
footer { text-align:center; padding:1rem; font-size:0.8rem; color:var(--gray); border-top:1px solid var(--border); margin-top:3rem; }
/* Modal */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:2000; }
.modal-content { background:var(--card); padding:2rem; border-radius:12px; width:90%; max-width:400px; box-shadow:var(--glow); display:flex; flex-direction:column; gap:1rem; }
.modal-content h2 { margin:0; color:var(--orange); }
.modal-content input { background:#222; border:none; border-radius:8px; padding:0.75rem; color:#fff; }
.modal-content button { width:100%; padding:0.75rem; }
.close-btn { background:#444; margin-top:0.5rem; }
</style>
</head>
<body>
<nav class="navbar">
  <div class="nav-logo">TrendTime</div>
  <div class="nav-actions">
    <img id="avatar" src="https://placehold.co/36x36" alt="Profile" />
    <button id="signupBtn">Sign Up</button>
    <button id="loginBtn">Log In</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</nav>

<main>
  <section class="composer" id="composerSection">
    <form id="trendForm">
      <textarea id="trendText" placeholder="What's trending?" required></textarea>
      <input type="url" id="videoUrl" placeholder="Video URL or YouTube link" />
      <button type="submit">Post Trend</button>
    </form>
  </section>
  <section id="trendFeed" class="feed"></section>
</main>

<button class="floating-btn" onclick="document.querySelector('#composerSection').scrollIntoView({behavior:'smooth'})">+</button>

<footer>&copy; 2025 TrendTime. Built by MgnGodly.</footer>

<!-- Auth Modal -->
<div id="authModal" class="modal">
  <div class="modal-content">
    <h2 id="modalTitle">Sign Up</h2>
    <input type="email" id="authEmail" placeholder="Email" required />
    <input type="password" id="authPassword" placeholder="Password" required />
    <button id="authSubmit">Continue</button>
    <button class="close-btn" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabase = createClient(
  'https://kpdgmbjdaynplyjacuxd.supabase.co',
  'YOUR_PUBLIC_ANON_KEY'
)

const signupBtn=document.getElementById("signupBtn")
const loginBtn=document.getElementById("loginBtn")
const logoutBtn=document.getElementById("logoutBtn")
const avatar=document.getElementById("avatar")
const form=document.getElementById("trendForm")
const feed=document.getElementById("trendFeed")
const composer=document.getElementById("composerSection")

const modal=document.getElementById("authModal")
const modalTitle=document.getElementById("modalTitle")
const authEmail=document.getElementById("authEmail")
const authPassword=document.getElementById("authPassword")
const authSubmit=document.getElementById("authSubmit")
let authMode="signup"

function openModal(mode){
  authMode=mode
  modalTitle.textContent= mode==="signup"?"Sign Up":"Log In"
  modal.style.display="flex"
}
function closeModal(){ modal.style.display="none" }

signupBtn.onclick=()=>openModal("signup")
loginBtn.onclick=()=>openModal("login")

authSubmit.onclick=async()=>{
  const email=authEmail.value.trim()
  const password=authPassword.value.trim()
  if(!email||!password) return alert("Fill in all fields")
  let result
  if(authMode==="signup"){
    result=await supabase.auth.signUp({email,password})
  } else {
    result=await supabase.auth.signInWithPassword({email,password})
  }
  if(result.error) alert(result.error.message)
  else { closeModal(); checkAuth() }
}

logoutBtn.onclick=async()=>{ await supabase.auth.signOut(); checkAuth() }

async function ensureProfile(user){
  const { data:existing }=await supabase.from("profiles").select().eq("id",user.id).single()
  if(!existing){ await supabase.from("profiles").insert([{id:user.id,username:user.email.split("@")[0],avatar_url:""}]) }
}

async function checkAuth(){
  const { data:{session} }=await supabase.auth.getSession()
  const user=session?.user
  if(user){
    signupBtn.style.display="none"; loginBtn.style.display="none"
    logoutBtn.style.display="inline-block"; avatar.style.display="inline-block"
    composer.style.display="block"
    await ensureProfile(user)
  } else {
    signupBtn.style.display="inline-block"; loginBtn.style.display="inline-block"
    logoutBtn.style.display="none"; avatar.style.display="none"
    composer.style.display="none"
  }
}

function isYouTube(url){ return url.includes("youtube.com")||url.includes("youtu.be") }

function renderTrend(trend,profile){
  const card=document.createElement("div"); card.className="trend-card"
  const header=document.createElement("div"); header.className="trend-header"
  const userAvatar=document.createElement("img"); userAvatar.src=profile?.avatar_url||"https://placehold.co/40x40"; header.appendChild(userAvatar)
  const info=document.createElement("div")
  const userTag=document.createElement("div"); userTag.className="trend-user"; userTag.textContent=profile?.username||"Anonymous"
  info.appendChild(userTag); header.appendChild(info); card.appendChild(header)
  const textEl=document.createElement("div"); textEl.className="trend-text"; textEl.textContent=trend.text; card.appendChild(textEl)
  if(trend.video_url){
    if(isYouTube(trend.video_url)){
      let id=trend.video_url.includes("youtu.be")?trend.video_url.split("/").pop():new URL(trend.video_url).searchParams.get("v")
      const iframe=document.createElement("iframe"); iframe.src=`https://www.youtube.com/embed/${id}`; iframe.height=300; iframe.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"; iframe.allowFullscreen=true; card.appendChild(iframe)
    } else {
      const video=document.createElement("video"); video.src=trend.video_url; video.controls=true; card.appendChild(video)
    }
  }
  feed.prepend(card)
}

form.addEventListener("submit",async e=>{
  e.preventDefault()
  const text=document.getElementById("trendText").value.trim()
  const video_url=document.getElementById("videoUrl").value.trim()
  const { data:{session} }=await supabase.auth.getSession()
  const user=session?.user
  if(!user) return alert("You must log in to post.")
  await ensureProfile(user)
  const { error }=await supabase.from("trends").insert([{ text, video_url: video_url||null, user_id:user.id }])
  if(error) alert(error.message)
  else { form.reset(); loadTrends() }
})

async function loadTrends(){
  const { data:trends,error }=await supabase.from("trends").select("id,text,video_url,user_id").order("id",{ascending:false})
  if(error) return console.error(error)
  feed.innerHTML=""
  for(const trend of trends){
    let profile={username:"Anonymous",avatar_url:"https://placehold.co/40x40"}
    const { data:profileData }=await supabase.from("profiles").select("username,avatar_url").eq("id",trend.user_id).single()
    if(profileData) profile=profileData
    renderTrend(trend,profile)
  }
}

supabase.channel("realtime-trends").on("postgres_changes",{event:"INSERT",schema:"public",table:"trends"},async payload=>{
  const trend=payload.new
  let profile={username:"Anonymous",avatar_url:"https://placehold.co/40x40"}
  const { data:profileData }=await supabase.from("profiles").select("username,avatar_url").eq("id",trend.user_id).single()
  if(profileData) profile=profileData
  renderTrend(trend,profile)
}).subscribe()

checkAuth()
loadTrends()
</script>
</body>
</html>
